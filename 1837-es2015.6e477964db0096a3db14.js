(self.webpackChunkion_tk_social_network=self.webpackChunkion_tk_social_network||[]).push([[1837],{51837:function(e,n,t){"use strict";t.r(n),t.d(n,{MessageDetailPageModule:function(){return B}});var o=t(61116),s=t(75425),i=t(6921),a=t(57476),r=t(39238),g=t(64762),c=t(31041),l=t(74249),p=t(61071),m=t(97425),d=t(9153),u=t(90343),x=t(18995),f=t(5118),h=t(43792),C=t(78194),M=t(29609),b=t(96859),_=t(33316),v=t(85649);const Z=["appMessagesDetailFooter",""];function O(e,n){if(1&e){const e=_.EpF();_.TgZ(0,"ion-button",8),_.NdJ("mousedown",function(n){return _.CHM(e),_.oxw().sendMessage(n)}),_._UZ(1,"ion-icon",9),_.qZA()}}function P(e,n){1&e&&(_.TgZ(0,"ion-button"),_._UZ(1,"ion-icon",10),_.qZA())}let y=(()=>{class e{constructor(e){this.store=e,this.messageControl=new c.NI("",[c.kI.required])}sendMessage(e){return(0,g.mG)(this,void 0,void 0,function*(){e.preventDefault();const n=this.store.selectSnapshot(e=>e.router.state.root.params.messageId);yield(0,d.n)(this.store.dispatch(new f.b.Send(n,this.messageControl.value))),setTimeout(()=>{this.messageControl.setValue(""),this.ionContent.scrollToBottom(0)})})}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)(_.Y36(p.yh))},e.\u0275cmp=_.Xpm({type:e,selectors:[["","appMessagesDetailFooter",""]],inputs:{ionContent:"ionContent"},attrs:Z,decls:11,vars:6,consts:[[2,"height","auto"],["slot","start"],["slot","icon-only","name","add-circle-outline","color","primary"],["autoGrow","","rows","1","cols","10",1,"message-textarea",3,"placeholder","formControl"],["slot","end"],["slot","icon-only","name","happy-outline","color","primary"],[3,"mousedown",4,"ngIf"],[4,"ngIf"],[3,"mousedown"],["slot","icon-only","name","send-outline","color","primary"],["slot","icon-only","name","mic-outline","color","primary"]],template:function(e,n){1&e&&(_.TgZ(0,"ion-toolbar",0),_.TgZ(1,"ion-buttons",1),_.TgZ(2,"ion-button"),_._UZ(3,"ion-icon",2),_.qZA(),_.qZA(),_._UZ(4,"ion-textarea",3),_.ALo(5,"translate"),_.TgZ(6,"ion-buttons",4),_.TgZ(7,"ion-button"),_._UZ(8,"ion-icon",5),_.qZA(),_.YNc(9,O,2,0,"ion-button",6),_.YNc(10,P,2,0,"ion-button",7),_.qZA(),_.qZA()),2&e&&(_.xp6(4),_.Q6J("placeholder",_.lcZ(5,4,"message"))("formControl",n.messageControl),_.xp6(5),_.Q6J("ngIf",n.messageControl.valid),_.xp6(1),_.Q6J("ngIf",!n.messageControl.valid))},directives:[l.sr,l.Sm,l.YG,l.gu,l.g2,l.j9,c.JJ,c.oH,o.O5],pipes:[v.X$],styles:[".message-textarea[_ngcontent-%COMP%]{max-height:100px;--background:var(--ion-color-light);border-radius:20px;--padding-top:10px;--padding-end:10px;--padding-bottom:10px;--padding-start:10px}"]}),e})();var A=t(12905);const w=function(e){return{scrolling:e}};let k=(()=>{class e{constructor(){this.isPageScrolling=!1,this.amCalendarGroup={sameDay:"[Today]",lastDay:"[Yesterday]",lastWeek:"[Last] dddd",sameElse:"DD-MM-YYYY"}}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-message-divider"]],inputs:{isPageScrolling:"isPageScrolling",createdAt:"createdAt"},decls:5,vars:9,consts:[["sticky","",1,"message-divider",3,"ngClass"]],template:function(e,n){1&e&&(_.TgZ(0,"ion-item-divider",0),_.TgZ(1,"ion-label"),_._uU(2),_.ALo(3,"amCalendar"),_.ALo(4,"amFromUtc"),_.qZA(),_.qZA()),2&e&&(_.Q6J("ngClass",_.VKq(7,w,n.isPageScrolling)),_.xp6(2),_.hij(" ",_.xi3(3,2,_.lcZ(4,5,n.createdAt),n.amCalendarGroup)," "))},directives:[l.rH,o.mk,l.Q$],pipes:[A.tp,A.fk],styles:[".message-divider[_ngcontent-%COMP%]{position:relative;--background:transparent;z-index:4;margin:auto;border-bottom:0;--padding-end:0px;--padding-start:0px;--inner-padding-end:0px;--ion-safe-area-left:0px;--ion-safe-area-right:0px}.message-divider.scrolling[_ngcontent-%COMP%]{position:sticky;top:10px}.message-divider[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:12px;font-weight:500;text-align:center;margin:8px auto 0;padding:8px 16px;border-radius:20px;background:#fff;background:var(--ion-background-color,#fff)}"]}),e})();function T(e,n){if(1&e&&(_.TgZ(0,"ion-avatar",5),_._UZ(1,"img",6),_.qZA()),2&e){const e=_.oxw();_.xp6(1),_.Q6J("src",e.userAvatar,_.LSH)}}const S=function(e){return{"user-msg-padding":e}};let q=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-user-message"]],inputs:{isLastMessage:"isLastMessage",isLastUserMessage:"isLastUserMessage",userAvatar:"userAvatar",message:"message",createdAt:"createdAt"},decls:7,vars:9,consts:[["lines","none",1,"message-user"],["slot","start","class","ion-align-self-end user-avatar",4,"ngIf"],[1,"message-container",3,"ngClass"],[1,"text",3,"innerHTML"],[1,"time"],["slot","start",1,"ion-align-self-end","user-avatar"],[3,"src"]],template:function(e,n){1&e&&(_.TgZ(0,"ion-item",0),_.YNc(1,T,2,1,"ion-avatar",1),_.TgZ(2,"div",2),_._UZ(3,"span",3),_.TgZ(4,"small",4),_._uU(5),_.ALo(6,"amDateFormat"),_.qZA(),_.qZA(),_.qZA()),2&e&&(_.xp6(1),_.Q6J("ngIf",n.isLastMessage),_.xp6(1),_.Q6J("ngClass",_.VKq(7,S,n.isLastUserMessage)),_.xp6(1),_.Q6J("innerHTML",n.message,_.oJD),_.xp6(2),_.Oqu(_.xi3(6,4,n.createdAt,"hh:mm")))},directives:[l.Ie,o.O5,o.mk,l.BJ],pipes:[A.Ek],styles:['.message-container[_ngcontent-%COMP%]{position:relative;border-radius:18px;padding:8px 12px;margin-top:12px;margin-left:0;margin-right:0;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:0;margin-inline-end:0;max-width:70%}.message-container.user-msg-padding[_ngcontent-%COMP%]{margin-left:33px}.message-container[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-weight:400;font-size:14px;white-space:pre-wrap}.message-container[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]:after{content:"";width:3.4em;height:12px;display:inline-block;vertical-align:top;visibility:hidden;font-size:11px}.message-container[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{position:absolute;right:0;bottom:0;padding:4px 8px 4px 4px;line-height:14px;pointer-events:auto;color:var(--ion-color-medium)}.message-user[_ngcontent-%COMP%]{--padding-start:8px;--padding-end:0px;--ion-safe-area-left:0px;--min-height:32px}.message-user[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]{position:sticky;top:0;margin-right:0;-webkit-margin-end:8px;margin-inline-end:8px;width:26px;height:26px}.message-user[_ngcontent-%COMP%]   .message-container[_ngcontent-%COMP%]{background:rgb(var(--ion-color-medium-rgb),.2)}']}),e})(),I=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-my-message"]],inputs:{message:"message",createdAt:"createdAt"},decls:6,vars:5,consts:[["lines","none",1,"message-me"],["slot","end",1,"message-container"],[1,"text",3,"innerHTML"],[1,"time"]],template:function(e,n){1&e&&(_.TgZ(0,"ion-item",0),_.TgZ(1,"div",1),_._UZ(2,"span",2),_.TgZ(3,"small",3),_._uU(4),_.ALo(5,"amDateFormat"),_.qZA(),_.qZA(),_.qZA()),2&e&&(_.xp6(2),_.Q6J("innerHTML",n.message,_.oJD),_.xp6(2),_.Oqu(_.xi3(5,2,n.createdAt,"hh:mm")))},directives:[l.Ie],pipes:[A.Ek],styles:['.message-container[_ngcontent-%COMP%]{position:relative;border-radius:18px;padding:8px 12px;margin-top:12px;margin-left:0;margin-right:0;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:0;margin-inline-end:0;max-width:70%}.message-container.user-msg-padding[_ngcontent-%COMP%]{margin-left:33px}.message-container[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-weight:400;font-size:14px;white-space:pre-wrap}.message-container[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]:after{content:"";width:3.4em;height:12px;display:inline-block;vertical-align:top;visibility:hidden;font-size:11px}.message-container[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{position:absolute;right:0;bottom:0;padding:4px 8px 4px 4px;line-height:14px;pointer-events:auto;color:var(--ion-color-medium)}.message-me[_ngcontent-%COMP%]{--padding-start:8px;--padding-end:0px;--ion-safe-area-left:0px;--min-height:32px}.message-me[_ngcontent-%COMP%]   .message-container[_ngcontent-%COMP%]{background:rgb(var(--ion-color-primary-rgb),.2)}']}),e})();function J(e,n){if(1&e&&(_.TgZ(0,"ion-item",12),_.TgZ(1,"ion-avatar",1),_._UZ(2,"img",13),_.qZA(),_.TgZ(3,"ion-label",14),_._uU(4),_.TgZ(5,"p",14),_._uU(6),_.ALo(7,"amTimeAgo"),_.qZA(),_.qZA(),_.qZA()),2&e){const e=n.ngIf;_.xp6(2),_.Q6J("src",e.avatar,_.LSH),_.xp6(2),_.AsE(" ",e.firstName," ",e.lastName," "),_.xp6(2),_.Oqu(_.lcZ(7,4,e.lastOnline))}}function D(e,n){if(1&e&&(_._UZ(0,"app-user-message",25),_.ALo(1,"async")),2&e){const e=_.oxw(),n=e.index,t=e.last,o=e.$implicit,s=_.oxw().$implicit,i=_.oxw();_.Q6J("isLastMessage","me"===(null==s.data[n+1]?null:s.data[n+1].type)||t)("isLastUserMessage","me"!==(null==s.data[n+1]?null:s.data[n+1].type)&&!t)("userAvatar",_.lcZ(1,5,i.messageDetail$).avatar)("message",o.message)("createdAt",o.createdAt)}}function L(e,n){if(1&e&&_._UZ(0,"app-my-message",26),2&e){const e=_.oxw().$implicit;_.Q6J("message",e.message)("createdAt",e.createdAt)}}function U(e,n){if(1&e){const e=_.EpF();_.TgZ(0,"ion-item-sliding",18,19),_.NdJ("ionDrag",function(n){_.CHM(e);const t=_.MAs(1);return _.oxw(2).messageDraged(n,t)}),_.YNc(2,D,2,7,"app-user-message",20),_.YNc(3,L,1,2,"app-my-message",21),_.TgZ(4,"ion-item-options",22),_.TgZ(5,"ion-item-option",23),_._UZ(6,"ion-icon",24),_.qZA(),_.qZA(),_.qZA()}if(2&e){const e=n.$implicit;_.Q6J("id","message_"+e.id),_.xp6(2),_.Q6J("ngIf","user"===e.type),_.xp6(1),_.Q6J("ngIf","me"===e.type)}}function Y(e,n){if(1&e&&(_.TgZ(0,"ion-item-group",15),_._UZ(1,"app-message-divider",16),_.YNc(2,U,7,3,"ion-item-sliding",17),_.qZA()),2&e){const e=n.$implicit,t=_.oxw();_.xp6(1),_.Q6J("isPageScrolling",t.isPageScrolling)("createdAt",e.createdAt),_.xp6(1),_.Q6J("ngForOf",e.data)("ngForTrackBy",t.trackBy)}}const Q=[{path:"",component:(()=>{class e{constructor(e,n){this.store=e,this.navController=n,this.amCalendarGroup={sameDay:"[Today]",lastDay:"[Yesterday]",lastWeek:"[Last] dddd",sameElse:"DD-MM-YYYY"},this.isPageScrolling=!1,this.isAllowScroll=!0,this.messageControl=new c.NI("",[c.kI.required]),this.ionContentScrolling=new m.X(!1)}trackBy(e){return e}openServicePage(e){this.navController.navigateForward(e.link)}logScrollStart(){this.ionContentScrolling.next(!0)}logScrolling(e){}logScrollEnd(){this.ionContentScrolling.next(!1)}messageDraged(e,n){1===e.detail.ratio&&n.closeOpened()}sendMessage(e){return(0,g.mG)(this,void 0,void 0,function*(){e.preventDefault();const n=this.store.selectSnapshot(e=>e.router.state.root.params.messageId);yield(0,d.n)(this.store.dispatch(new f.b.Send(n,this.messageControl.value))),setTimeout(()=>{this.messageControl.setValue(""),this.ionContent.scrollToBottom(0)})})}setupIonContentScrollingListner(){this.ionContentScrolling.pipe((0,u.b)(e=>{e&&(this.isPageScrolling=e)}),(0,x.b)(1e3)).subscribe(e=>this.isPageScrolling=e)}ngOnInit(){this.setupIonContentScrollingListner()}ionViewWillEnter(){}ionViewDidEnter(){setTimeout(()=>(0,g.mG)(this,void 0,void 0,function*(){const e=this.store.selectSnapshot(e=>e.router.state.root.params.messageId);yield(0,d.n)(this.store.dispatch(new f.n.FetchMessageDetail(e))),yield this.ionContent.scrollToBottom(0)}))}ionViewDidLeave(){}}return e.\u0275fac=function(n){return new(n||e)(_.Y36(p.yh),_.Y36(l.SH))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-services"]],viewQuery:function(e,n){if(1&e&&_.Gf(l.W2,5),2&e){let e;_.iGM(e=_.CRH())&&(n.ionContent=e.first)}},decls:16,vars:13,consts:[[1,"ion-no-border",3,"translucent"],["slot","start"],["color","primary","defaultHref","/tabs/messages",3,"text"],["lines","none","style","--background: transparent",4,"ngIf"],["slot","end"],["color","primary"],["slot","icon-only","name","call-outline"],["slot","icon-only","name","videocam-outline"],[3,"fullscreen","scrollEvents","scrollY","ionScrollStart","ionScroll","ionScrollEnd"],["class","messages-item-group",4,"ngFor","ngForOf","ngForTrackBy"],[1,"ion-no-border"],["appMessagesDetailFooter","",3,"ionContent"],["lines","none",2,"--background","transparent"],[3,"src"],[1,"ion-no-margin"],[1,"messages-item-group"],[3,"isPageScrolling","createdAt"],["class","message-item-sliding",3,"id","ionDrag",4,"ngFor","ngForOf","ngForTrackBy"],[1,"message-item-sliding",3,"id","ionDrag"],["slidingItem",""],[3,"isLastMessage","isLastUserMessage","userAvatar","message","createdAt",4,"ngIf"],[3,"message","createdAt",4,"ngIf"],["side","end",1,"no-border"],["disabled","",2,"--background","var(--ion-item-background)"],["slot","icon-only","name","arrow-undo-outline","color","primary"],[3,"isLastMessage","isLastUserMessage","userAvatar","message","createdAt"],[3,"message","createdAt"]],template:function(e,n){1&e&&(_.TgZ(0,"ion-header",0),_.TgZ(1,"ion-toolbar"),_.TgZ(2,"ion-buttons",1),_._UZ(3,"ion-back-button",2),_.qZA(),_.YNc(4,J,8,6,"ion-item",3),_.ALo(5,"async"),_.TgZ(6,"ion-buttons",4),_.TgZ(7,"ion-button",5),_._UZ(8,"ion-icon",6),_.qZA(),_.TgZ(9,"ion-button",5),_._UZ(10,"ion-icon",7),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.TgZ(11,"ion-content",8),_.NdJ("ionScrollStart",function(){return n.logScrollStart()})("ionScroll",function(e){return n.logScrolling(e)})("ionScrollEnd",function(){return n.logScrollEnd()}),_.YNc(12,Y,3,4,"ion-item-group",9),_.ALo(13,"async"),_.qZA(),_.TgZ(14,"ion-footer",10),_._UZ(15,"div",11),_.qZA()),2&e&&(_.Q6J("translucent",!0),_.xp6(3),_.Q6J("text",""),_.xp6(1),_.Q6J("ngIf",_.lcZ(5,9,n.messageDetail$)),_.xp6(7),_.Q6J("fullscreen",!0)("scrollEvents",!0)("scrollY",n.isAllowScroll),_.xp6(1),_.Q6J("ngForOf",_.lcZ(13,11,n.messages$))("ngForTrackBy",n.trackBy),_.xp6(3),_.Q6J("ionContent",n.ionContent))},directives:[l.Gu,l.sr,l.Sm,l.oU,l.cs,o.O5,l.YG,l.gu,l.W2,o.sg,l.fr,y,l.Ie,l.BJ,l.Q$,l.Ub,k,l.td,l.IK,l.u8,q,I],pipes:[o.Ov,A.eG],styles:['.message-divider[_ngcontent-%COMP%]{position:relative;--background:transparent;z-index:4;margin:auto;border-bottom:0;--padding-end:0px;--padding-start:0px;--inner-padding-end:0px;--ion-safe-area-left:0px;--ion-safe-area-right:0px}.message-divider.scrolling[_ngcontent-%COMP%]{position:sticky;top:10px}.message-divider[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:12px;font-weight:500;text-align:center;margin:8px auto 0;padding:8px 16px;border-radius:20px;background:#fff;background:var(--ion-background-color,#fff)}.messages-item-group[_ngcontent-%COMP%]:last-child{margin-bottom:20px}.messages-item-group[_ngcontent-%COMP%]   .message-item-sliding[_ngcontent-%COMP%]:first-of-type   .message-container[_ngcontent-%COMP%]{margin-top:0}.messages-item-group[_ngcontent-%COMP%]   .message-me[_ngcontent-%COMP%]{--padding-start:8px;--padding-end:0px;--ion-safe-area-left:0px;--min-height:32px}.messages-item-group[_ngcontent-%COMP%]   .message-me[_ngcontent-%COMP%]   .message-container[_ngcontent-%COMP%]{background:rgb(var(--ion-color-primary-rgb),.2)}.messages-item-group[_ngcontent-%COMP%]   .message-user[_ngcontent-%COMP%]{--padding-start:8px;--padding-end:0px;--ion-safe-area-left:0px;--min-height:32px}.messages-item-group[_ngcontent-%COMP%]   .message-user[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]{position:sticky;top:0;margin-right:0;-webkit-margin-end:8px;margin-inline-end:8px;width:26px;height:26px}.messages-item-group[_ngcontent-%COMP%]   .message-user[_ngcontent-%COMP%]   .message-container[_ngcontent-%COMP%]{background:rgb(var(--ion-color-medium-rgb),.2)}.messages-item-group[_ngcontent-%COMP%]   .message-container[_ngcontent-%COMP%]{position:relative;border-radius:18px;padding:8px 12px;margin-top:12px;margin-left:0;margin-right:0;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:0;margin-inline-end:0;max-width:70%}.messages-item-group[_ngcontent-%COMP%]   .message-container.user-msg-padding[_ngcontent-%COMP%]{margin-left:33px}.messages-item-group[_ngcontent-%COMP%]   .message-container[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-weight:400;font-size:14px;white-space:pre-wrap}.messages-item-group[_ngcontent-%COMP%]   .message-container[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]:after{content:"";width:3.4em;height:12px;display:inline-block;vertical-align:top;visibility:hidden;font-size:11px}.messages-item-group[_ngcontent-%COMP%]   .message-container[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{position:absolute;right:0;bottom:0;padding:4px 8px 4px 4px;line-height:14px;pointer-events:auto;color:var(--ion-color-medium)}.message-textarea[_ngcontent-%COMP%]{max-height:100px;--background:var(--ion-color-light);border-radius:20px;--padding-top:10px;--padding-end:10px;--padding-bottom:10px;--padding-start:10px}.item-options-ios.item-options-end[_ngcontent-%COMP%]{border-bottom-width:0}']}),(0,g.gn)([(0,p.Ph)((0,p.P1)([b.mf,h.uu],(e,n)=>e.listData[n.state.root.params.messageId]))],e.prototype,"messageDetail$",void 0),(0,g.gn)([(0,p.Ph)((0,p.P1)([b.mf,h.uu],(e,n)=>{const t=e.listData[n.state.root.params.messageId];return t?(0,C.chain)(t.messages).groupBy(e=>M(e.createdAt).format("DD-MM-YYYY")).map(e=>({createdAt:e[0].createdAt,data:e})).value():[]}))],e.prototype,"messages$",void 0),e})()}];let F=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=_.oAB({type:e}),e.\u0275inj=_.cJS({imports:[[r.Bz.forChild(Q)],r.Bz]}),e})(),B=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=_.oAB({type:e}),e.\u0275inj=_.cJS({imports:[[o.ez,F,i.H,a.i,s.m]]}),e})()}}]);